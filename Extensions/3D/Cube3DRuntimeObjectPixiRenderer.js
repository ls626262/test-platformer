var gdjs;(function(p){const x={3:0,2:1,5:2,4:3,0:4,1:5},M={0:3,1:2,2:5,3:4,4:0,5:1},n={0:[0,0],1:[1,0],2:[0,1],3:[1,1]},R={0:[0,1],1:[0,0],2:[1,1],3:[1,0]};let g;const _=()=>(g||(g=new THREE.MeshBasicMaterial({transparent:!0,opacity:0,alphaTest:1})),g),T=(h,i)=>h.isFaceAtIndexVisible(i)?h.getInstanceContainer().getGame().getImageManager().getThreeMaterial(h.getFaceAtIndexResourceName(i),{useTransparentTexture:h.shouldUseTransparentTexture(),forceBasicMaterial:h._materialType===p.Cube3DRuntimeObject.MaterialType.Basic,vertexColors:!0}):_();class f extends p.RuntimeObject3DRenderer{constructor(i,t){const o=new THREE.BoxGeometry(1,1,1),m=new Array(6).fill(0).map((e,d)=>T(i,M[d])),b=new THREE.Mesh(o,m);super(i,t,b);this._boxMesh=b,this._cube3DRuntimeObject=i,this.updateSize(),this.updatePosition(),this.updateRotation(),this.updateTint()}updateTint(){const i=[],t=p.rgbOrHexToRGBColor(this._cube3DRuntimeObject.getColor()).map(o=>o/255);for(let o=0;o<this._boxMesh.geometry.attributes.position.count;o++)i.push(...t);this._boxMesh.geometry.setAttribute("color",new THREE.BufferAttribute(new Float32Array(i),3))}updateFace(i){const t=x[i];t!==void 0&&(this._boxMesh.material[t]=T(this._cube3DRuntimeObject,i),this._cube3DRuntimeObject.isFaceAtIndexVisible(i)&&this.updateTextureUvMapping(i))}updateSize(){super.updateSize(),this.updateTextureUvMapping()}updateTextureUvMapping(i){const t=this._boxMesh.geometry.getAttribute("position"),o=this._boxMesh.geometry.getAttribute("uv"),m=i===void 0?0:x[i]*4,b=i===void 0?23:x[i]*4+3;for(let e=m;e<=b;e++){const d=Math.floor(e/4),r=this._boxMesh.material[d];if(!r||!r.map)continue;const c=this._cube3DRuntimeObject.shouldRepeatTextureOnFaceAtIndex(M[d]),u=this._cube3DRuntimeObject.getFacesOrientation()==="Y";let a,s;switch(d){case 0:c?u?(a=-(this._boxMesh.scale.z/r.map.source.data.width)*(t.getZ(e)-.5),s=-(this._boxMesh.scale.y/r.map.source.data.height)*(t.getY(e)+.5)):(a=-(this._boxMesh.scale.y/r.map.source.data.width)*(t.getY(e)-.5),s=this._boxMesh.scale.z/r.map.source.data.height*(t.getZ(e)-.5)):u?[a,s]=n[e%4]:[a,s]=R[e%4];break;case 1:c?u?(a=this._boxMesh.scale.z/r.map.source.data.width*(t.getZ(e)+.5),s=-(this._boxMesh.scale.y/r.map.source.data.height)*(t.getY(e)+.5)):(a=this._boxMesh.scale.y/r.map.source.data.width*(t.getY(e)+.5),s=this._boxMesh.scale.z/r.map.source.data.height*(t.getZ(e)-.5)):u?[a,s]=n[e%4]:([a,s]=R[e%4],a=-a,s=-s);break;case 2:c?(a=this._boxMesh.scale.x/r.map.source.data.width*(t.getX(e)+.5),s=this._boxMesh.scale.z/r.map.source.data.height*(t.getZ(e)-.5)):[a,s]=n[e%4];break;case 3:c?u?(a=this._boxMesh.scale.x/r.map.source.data.width*(t.getX(e)+.5),s=-(this._boxMesh.scale.z/r.map.source.data.height)*(t.getZ(e)+.5)):(a=-(this._boxMesh.scale.x/r.map.source.data.width)*(t.getX(e)-.5),s=this._boxMesh.scale.z/r.map.source.data.height*(t.getZ(e)-.5)):([a,s]=n[e%4],u||(a=-a,s=-s));break;case 4:c?(a=this._boxMesh.scale.x/r.map.source.data.width*(t.getX(e)+.5),s=-(this._boxMesh.scale.y/r.map.source.data.height)*(t.getY(e)+.5)):[a,s]=n[e%4];break;case 5:const l=this._cube3DRuntimeObject.getBackFaceUpThroughWhichAxisRotation()==="X";c?(a=(l?1:-1)*(this._boxMesh.scale.x/r.map.source.data.width)*(t.getX(e)+(l?1:-1)*.5),s=(l?1:-1)*(this._boxMesh.scale.y/r.map.source.data.height)*(t.getY(e)+(l?-1:1)*.5)):([a,s]=n[e%4],l&&(a=-a,s=-s));break;default:[a,s]=n[e%4]}o.setXY(e,a,s)}o.needsUpdate=!0}_updateMaterials(){for(let i=0;i<6;i++)this.updateFace(i)}}p.Cube3DRuntimeObjectRenderer=f})(gdjs||(gdjs={}));
//# sourceMappingURL=Cube3DRuntimeObjectPixiRenderer.js.map
